<h1>Инструкция</h1>
<h2>1. Настройка окружения</h2>
<p>Установить Docker с официального сайта или запустить docker-сервер командой <code>dockerd</code>.</p>
<p><strong>1.1. Документация:</strong></p>
<p>1.1.1. Перейти в папку с документацией: <code>cd docs</code></p>
<p>1.1.2. Собрать документацию в docker-контейнер: <code>docker build -t docs-img .</code> (нужен доступ к интернету)</p>
<p>1.1.3. Сохранить docker-образ в папку docker-img: <code>docker save docs-img > docker-img/docs-img.tar</code></p>
<p>1.1.4. Заархивировать docker-образ: <code>tar -zcvf docker-img/docs-img.tar.gz docker-img/docs-img.tar</code></p>
<p><strong>1.2. Робот:</strong></p>
<p>1.2.1. Перейти в корневую папку проекта Armbot</p>
<p>1.2.2. Собрать окружение для робота в docker-контейнер: <code>docker build -t armbot-img . --network=host --build-arg from=ubuntu:18.04</code></p>
<p>1.2.3. Сохранить docker-образ: <code>docker save armbot-img > armbot-img.tar</code></p>
<p>1.2.4. Заархивировать docker-образ: <code>tar -zcvf armbot-img.tar.gz armbot-img.tar</code></p>
<p><strong>1.3. Перенести на целевую машину</strong></p>
<p>1.3.1. Скачать архивы docs-img.tar.gz и armbot-img.tar.gz на флешку. Скопировать на целевую машину</p>
<p>1.3.2. Разархивировать docs-img.tar.gz: <code>tar -xvf docs-img.tar.gz</code></p>
<p>1.3.3. Разархивировать armbot-img.tar.gz: <code>tar -xvf armbot-img.tar.gz</code></p>
<p>1.3.4. Загрузить docker-образ документации: <code>docker load < docs-img.tar</code></p>
<p>1.3.5. Загрузить docker-образ робота: <code>docker load < armbot-img.tar</code></p>
<p><br /></p>

<h2>2. Установить переменные среды <sup>*</sup></h2>
<p><i><sup>*</sup> Пропустить пункт при запуске с докером.</i></p>
<p>Нужно прописать путь до проекта.</p>
<p>Добавьте переменные среды в файл <code>.bashrc</code></p>
<p>Примените изменения <code>source ~/.bashrc</code></p>
<p><br /></p>

<h2>3. Запустить документацию, настроить скрипты</h2>
<p>3.1. Дать права на запуск скриптов: <code>sudo chmod +x scripts/*sh</code></p>
<p>3.1*. Исправить ошибку перед запуском скриптов (преобразование окончаний строк из формата DOS в формат UNIX):</p>
  <pre><code>sed -i -e 's/\r$//' scripts/run_docs_docker.sh</code>
<code>sed -i -e 's/\r$//' scripts/run_armbot_docker.sh</code>
<code>sed -i -e 's/\r$//' scripts/run.sh</code>
<code>sed -i -e 's/\r$//' scripts/get_data.sh</code>
</pre>
<p>3.2. Запустить docker-контейнер с документацией: <code>./scripts/run_docs_docker.sh</code>. Перейти на <code>localhost</code></p>
<p>* - опционально</p>
<p><br /></p>

<h2>4. Запустить робота</h2>
<p>0<sup>*</sup>. Открыть скетч <code>/armbot_move/control-arduino/move_arduino/move_arduino.ino</code> в Arduino IDE. Загрузить скетч.</p>
<p><i><sup>*</sup> Пропустить этот шаг, если нужный скетч уже загружен на плату Arduino.</i></p>
<p>Перейти в корень проекта. Открыть 4 окна терминала.</p>
<p>1 терминал:</p>
<ul>
  <li>Запустить docker-контейнер с окружением для робота: <code>./scripts/run_armbot_docker.sh</code></li>
  <li>Перейти в рабочую директорию <code>cd workspace</code></li>
  <li>Собрать проект <code>catkin_make</code> (если будут ошибки сборки, можно попробовать собрать пакеты изолированно <code>catkin_make_isolated</code>)</li>
  <li>Прописать пути <code>source devel/setup.bash</code></li>
  <li>Запустить модель робота <code>roslaunch armbot_move armbot.rviz.launch</code></li>
</ul>
<p>2 терминал:</p>
<ul>
  <li>Зайти в docker-контейнер <code>sudo docker exec -ti armbot bash</code></li>
  <li>Перейти в рабочую директорию <code>cd workspace</code></li>
  <li>Прописать пути <code>source devel/setup.bash</code></li>
  <li>Запустить подписчик на движения <code>roslaunch armbot_move move.rviz.launch</code></li>
</ul>
<p>3 терминал:</p>
<ul>
  <li>Зайти в docker-контейнер <code>sudo docker exec -ti armbot bash</code></li>
  <li>Перейти в рабочую директорию <code>cd workspace</code></li>
  <li>Прописать пути <code>source devel/setup.bash</code></li>
  <li>Запустить подписчик движений на Arduino <code>rosrun rosserial_python serial_node.py _port:=/dev/ttyUSB0 _baud:=115200</code></li>
</ul>
<p>4 терминал:</p>
<ul>
  <li>Запустить публикацию движений с докером <code>./scripts/armbot.sh start</code></li>
</ul>
<p><br /></p>

<h2>Описание команд</h2>
<p>Файл command_description.txt. Пример описания команды:</p>
<pre><code>direct:0.2872 4.83407e-10
right:-0.180411 -0.223463
left:-0.180411 0.223463
</code>
</pre>
<p>Файл commands.txt. Пример описания перечня выполняемых команд:</p>
<pre><code>right 6
left 4
</code>
</pre>
